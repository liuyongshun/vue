<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no" />
		<title>导航</title>
		<link rel="stylesheet" href="css/style.css">
        <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="js/rem.js"></script>
        <script type="text/javascript" src="js/template-web.js"></script>
        <script type="text/javascript" src="js/commen.js"></script>
        <script type="text/javascript" src="js/md5.min.js"></script>
        <script src="js/mui.min.js"></script>
    </head>
    <body style="background: #f4f5f7;">
        <div class="z_channel_container">
            <div class="z_channel_title">我的频道<span>点击取消频道</span></div>
            <ul id="foo" class="z_channel_content">
            </ul>
        </div>

        <div class="z_channel_container">
            <div class="z_channel_title">全部频道<span>点击添加频道</span></div>
            <ul id="bar" class="z_channel_content">
            </ul>
        </div>
        <input type="button" value="保存" class="b_mom_btn z_channel_btn">
        <div class="b_reminder-msg"><div class="b-msg"></div></div>
    <!--<script src="js/Sortable.min.js"></script>-->
    <script type="text/javascript">
        (function (){
            //获取用户频道数据
            var myChanel = [];
            $.ajax({
                url:AjaxUrl+'MyChannel',
                type:'POST',
                dataType:'json',
                data:{
                    'i_ui_identifier':dataUser.data.i_ui_identifier,
                    'password':dataUser.data.password
                },
                success: function(data){
                    console.log(data)
                    if(data.status=="success"){
                        for(var i=0; i<data.data.length; i++){
                            var html = '<li id="'+data.data[i].i_mc_identifier+'">'+data.data[i].nvc_name+'</li>';
                            if (data.data[i].type == '1'){
                                $("#foo").append(html);
                                var myChannelObj = {};
                                myChannelObj.mc_id= data.data[i].i_mc_identifier;
                                myChannelObj.name = data.data[i].nvc_name;
                                myChanel[i] = myChannelObj;
                            }else {
                                $("#bar").append(html);
                            }
                        }
                        console.log(myChanel);
                    }else{
                        $(".b-msg").empty()//每次将内容清空
                        $(".b-msg").html(data.Msg).show().delay(2000).fadeOut()
                    }
                }
            })
            //点击取消频道
            mui("#foo").on('tap','li',function () {
                var myId = $(this).attr('id'),
                    myText = $(this).text();
                $(this).remove();
                $("#bar").append('<li id="'+myId+'">'+myText+'</li>');
                for (var j=0; j<myChanel.length; j++){
                    if (myId == myChanel[j].mc_id){
                        myChanel.splice(j,1);
                    }
                }
            })
            //点击添加频道
            mui("#bar").on('tap','li',function () {
                var allId = $(this).attr('id'),
                    allText = $(this).text(),
                    mychannelAdd = {
                        mc_id:allId,
                        name:allText
                    };
                $(this).remove();
                $("#foo").append('<li id="'+allId+'">'+allText+'</li>');
                myChanel.push(mychannelAdd);
            })
            //保存提交数据
            $(".z_channel_btn").on('click',function () {
                var myIds = [],
                    myName = [];
                for (var i=0; i<myChanel.length;i++){
                    myIds.push(myChanel[i].mc_id);
                    myName.push(myChanel[i].name);
                }
                var mc_ids = myIds.join(','),
                    mc_names = myName.join(',');
//                console.log(mc_ids);
//                console.log(mc_names)
                $.ajax({
                    url:AjaxUrl+'MyChannelSave',
                    type:'POST',
                    dataType:'json',
                    data:{
                        'mc_ids':mc_ids,
                        'mc_names':mc_names,
                        'i_ui_identifier':dataUser.data.i_ui_identifier,
                        'password':dataUser.data.password
                    },
                    success: function(data){
                        console.log(data)
                        if(data.status=="success"){
                            $(".b-msg").html(data.Msg).show().delay(2000).fadeOut()
                            setTimeout("window.location='index.html'",1000)
                        }else{
                            $(".b-msg").html(data.Msg).show().delay(2000).fadeOut()
                        }
                    }
                })
            })
//            var console = window.console;
//
//            if( !console.log ){
//                console.log = function (){
//                    alert([].join.apply(arguments, ' '));
//                };
//            }

//            Sortable.create(foo, {
//                group: "words",
//                animation: 150,
//                store: {
//                    get: function (sortable) {
//                        var order = localStorage.getItem(sortable.options.group);
//                        return order ? order.split('|') : [];
//                    },
//                    set: function (sortable) {
//                        var order = sortable.toArray();
//                        localStorage.setItem(sortable.options.group, order.join('|'));
//                    }
//                },
//                onAdd: function (evt){ console.log('onAdd.foo:', [evt.item, evt.from]); },
//                onUpdate: function (evt){ console.log('onUpdate.foo:', [evt.item, evt.from]); },
//                onRemove: function (evt){ console.log('onRemove.foo:', [evt.item, evt.from]); },
//                onStart:function(evt){ console.log('onStart.foo:', [evt.item, evt.from]);},
//                onSort:function(evt){ console.log('onStart.foo:', [evt.item, evt.from]);},
//                onEnd: function(evt){
//                    console.log('onEnd.foo:', [evt.item, evt.from]);
//                    console.log('sadfsajkldfas')
//                }
//
//            });

            // Sortable.create(bar, {
            // 	group: "words",
            // 	animation: 150,
            // 	onAdd: function (evt){ console.log('onAdd.bar:', evt.item); },
            // 	onUpdate: function (evt){ console.log('onUpdate.bar:', evt.item); },
            // 	onRemove: function (evt){ console.log('onRemove.bar:', evt.item); },
            // 	onStart:function(evt){ console.log('onStart.foo:', evt.item);},
            // 	onEnd: function(evt){ console.log('onEnd.foo:', evt.item);}
            // });
        })();
    </script>
    </body>

</html>
