<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no" />
  <title>忘记密码</title>
  <link rel="stylesheet" href="../css/style.css">
  <script type="text/javascript" src="../js/jquery-1.9.1.js"></script>
  <script type="text/javascript" src="../js/rem.js"></script>
  <script type="text/javascript" src="../js/commen.js"></script>
  <script type="text/javascript" src="../js/md5.min.js"></script>

</head>


<body>
<div class="b_login">
  <div class="b_login_div">
    <input id="origin" type="password" placeholder="请输入原密码" class="b_login-input origin_pwd small-width">
    <img src="../images/yjj@3x.png" class="eye-password">
  </div>
  <div class="b_login_div">
    <input id="new" type="password" placeholder="请输入新密码" class="b_login-input new_pwd small-width">
    <img src="../images/yjj@3x.png" class="eye-password">
  </div>
  <div class="b_login_div">
    <input id="again" type="password" placeholder="请再次输入新密码" class="b_login-input certain_new_pwd small-width">
    <img src="../images/yjj@3x.png" class="eye-password">
  </div>
  <input type="button" value="保存" class="b_mom_btn" id="newpassword-submit" style="margin-top:1rem">
  <div class="b_reminder-msg"><div class="b-msg"></div></div>
</div>
<script>
  // variable
  var loginData = get('loginData');
  var $msg = $('.b-msg');
  
  // event show or hide password
  $('.b_login_div').on('click', '.eye-password', function () {
    var $this = $(this);
    var $type = $this.prev().attr('type');
    
    if ($type === 'text') {
      $this.attr('src', '../images/yjj@3x.png').prev().attr('type', 'password');
    } else {
      $this.attr('src', '../images/yj@3x.png').prev().attr('type', 'text');
    }
  });
  
  $('#newpassword-submit').on('click', function() {
    
    var originPWD = $('#origin').val();
    var md5PWD = md5(originPWD).toUpperCase();
    var newPWD = $('#new').val();
    var againPWD = $('#again').val();
    
    if (originPWD === '') {
      $msg.html('原密码为空').show().delay(2000).fadeOut();
      
    }else if (newPWD ==='') {
      $msg.html('新密码为空').show().delay(2000).fadeOut();
      
    }else if (againPWD === '') {
      $msg.html('请再次输入密码').show().delay(2000).fadeOut();
      
    }else if (newPWD !== againPWD) {
      $msg.html('两次输入的密码不一致').show().delay(2000).fadeOut();
      
    } else {
      $.ajax({
        url:AjaxUrl + 'ChangePassword',
        type:'POST',
        dataType:'json',
        data:{
          'i_ui_identifier': loginData.data.i_ui_identifier,
          'old_password': md5PWD,
          'password': newPWD
        },
        success: function (data) {
          if (data.status === 'success') {
            $msg.empty();
            $msg.html(data.Msg).show().delay(2000).fadeOut();
            localStorage.clear('loginData');
            location.href = '../login.html';
          } else {
            $msg.empty();
            $msg.html(data.Msg).show().delay(2000).fadeOut();
          }
        }
      })
    }
  });
  
  //倒计时60
  $('#send-code').on('click',function () {
    Sendcode('2');
  })
  var countdown=60;
  var code3 = $('#send-code');
  function settime() {
    console.log(5678)
    
    if (countdown == 0) {
      
      code3.attr('disabled',false);
      code3.val('获取验证码');
      code3.css({
        borderColor:'#e43a3d',
        color:'#e43a3d'
      })
      countdown = 60;
      return false;
      
    } else {
      
      $('#send-code').attr('disabled', true);
      code3.val(countdown+"s后重新发送");
      code3.css({
        borderColor:'#ccc',
        color:'#ccc'
      })
      countdown--;
      
    }
    setTimeout(function() {settime()},1000);
  }


</script>
</body>

</html>
