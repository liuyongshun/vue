<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no" />
  <link rel="stylesheet" href="../css/style.css">
  <script src="../js/jquery-1.9.1.js"></script>
  <script src="../js/commen.js"></script>
  <script src="../js/rem.js"></script>
  <script type="text/javascript" src="../js/zyFile.js"></script>
  <script type="text/javascript" src="../js/zyUpload.js"></script>
  <title>个人认证</title>
</head>

<body>
<div class="padlg">
  <ul class="l_tab_list" style="margin-bottom: 0;">
    <li class="l_list_cell">标题：<input id="title" class="l_input_pub" type="text"></li>
  </ul>
  <textarea style="margin-top: 0.24rem;" name="" id="detail" class="l_text_area" placeholder="我要来爆料"></textarea>
  <form method="post"  enctype="multipart/form-data" id="infoForm">
    <ul class="l_ID_card" style="margin-top: 0.2rem;">
      <li>
        <div class="fl" style="width: 99%;">
          <p class="l_card_pic">
            <img src="../images/uppic.png" id="headlogo">
          </p>
          <input type="file" name="file" onchange="imgPreview(this, 'headlogo')" id="file" style="display: none">
        </div>
      </li>
    </ul>
    <div class="div_botm_btn">
      <input type="button" value="发布" class="b_mom_btn">
    </div>
  </form>
</div>
<div class="b-msg"></div>
<script>
  var loginData = get('loginData');
  var $msg = $('.b-msg');
  
  function imgPreview(fileDom, id){
    //判断是否支持FileReader
    if (window.FileReader) {
      var reader = new FileReader();
    } else {
      alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
    }
    //获取文件
    var file = fileDom.files[0];
    var imageType = /^image\//;
    //是否是图片
    if (!imageType.test(file.type)) {
      alert("请选择图片！");
      return;
    }
    //读取完成
    reader.onload = function(e) {
      //获取图片dom
      var img = document.getElementById(id);
      //图片路径设置为读取的图片
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
  
  $(".l_card_pic").on('click', function () {
    var id = $(this).find('img').attr('id');
    
    if (id === 'headlogo') {
      $("#file").click();
      return false;
    }
    $("#fileAnther").click();
  });
  
  //上传图片初始化
  $(function(){
    // 初始化插件
    $("#imgUpload").zyUpload({
      width             :   "",                 // 宽度
      height            :   "",                 // 宽度
      itemWidth        :   "1rem",                 // 文件项的宽度
      itemHeight       :   "1rem",                 // 文件项的高度
      url               :  '',  // 上传文件的路径
      multiple         :   false,                    // 是否可以多个文件上传
      dragDrop         :   false,                    // 是否可以拖动上传文件
      del               :   true,                    // 是否可以删除文件
      finishDel        :   true,  				  // 是否在上传文件完成后删除预览
      /* 外部获得的回调接口 （备注：此处不能用，需要在zyUpload.js中设置）*/
      onSelect: function(files, allFiles){                    // 选择文件的回调方法
//                    console.info("当前选择了以下文件：");
//                    console.info(files);
//                    console.info("之前没上传的文件：");
//                    console.info(allFiles);
      },
      onDelete: function(file, surplusFiles){                     // 删除一个文件的回调方法
//                    console.info("当前删除了此文件：");
//                    console.info(file);
//                    console.info("当前剩余的文件：");
//                    console.info(surplusFiles);
      },
      onSuccess: function(file, response){                    // 文件上传成功的回调方法
//                    console.info("此文件上传成功：");
//                    console.info(file);
//                    console.info("0000000000000");
//					console.info(response);
      },
      onFailure: function(file){                    // 文件上传失败的回调方法
//                    console.info("此文件上传失败：");
//                    console.info(file);
      },
      onComplete: function(responseInfo){           // 上传完成的回调方法
//                    console.info("文件上传完成");
//                    console.info(responseInfo);
      }
    });
  });
  
  function ajaxDisclose (page) {
    $.ajax({
      url: AjaxUrl + 'TipoffList',
      type: 'POST',
      dataType: 'json',
      data: {
        'i_ui_identifier': loginData.data.i_ui_identifier,
        'password': loginData.data.password,
        'CurrentPage': page,
        'PageSize': '10'
      },
      success: function (data) {
        if (data.status === 'success') {
          $msg.html(data.Msg).show().delay(1000).fadeOut();
          setTimeout(function () {
            location.href = 'disclose_list.html';
          }, 1500)
        }
      }
    });
  }
  
  $('.b_mom_btn').on('click', function () {
    var title = $('#title').val();
    var detail = $('#detail').val();
    
    var form = new FormData(document.getElementById("infoForm"));
    
    form.append('title', title);
    form.append('content', detail);
    form.append('password', loginData.data.password);
    form.append('i_ui_identifier', loginData.data.i_ui_identifier);
    
    $.ajax({
      url:AjaxUrl + 'CreateTipoff',
      type:'POST',
      dataType:'json',
      data: form,
      cache: false,
      processData: false,
      contentType: false,
      success: function(data) {
        if (data.status === 'success') {
          $msg.html(data.Msg).show().delay(1000).fadeOut();
          setTimeout(function () {
            location.href = 'user-index.html';
          }, 1500)
        } else {
          $msg.empty()
          $msg.html(data.Msg).show().delay(1000).fadeOut();
        }
      }
    })
    
  });

</script>
</body>


</html>
