<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no" />
  <title>陶瓷快讯</title>
  <link rel="stylesheet" href="css/mui.css">
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
  <script type="text/javascript" src="js/rem.js"></script>
  <script type="text/javascript" src="js/commen.js"></script>
  <script src="js/mui.min.js"></script>
</head>
<body>
<div id="pullrefresh" class="mui-content mui-scroll-wrapper" style="margin-bottom: 0.8rem">
  <div class="mui-scroll">
    <ul class="l_list_pub mui-table-view mui-table-view-striped mui-table-view-condensed">
      <!--<li>-->
        <!--<a href="">-->
          <!--<div class="l_vedio_frame">-->
            <!--<h2 class="l_vedio_tit">河北省陶瓷</h2>-->
            <!--<em class="l_vedio_time">12万次播放</em>-->
            <!--<img src="./images/zzzz.png" alt="" class="l_vedio_bg" >-->
            <!--<img src="./images/bofang@3x.png" alt="" class="l_vedio_play">-->
            <!--<span class="l_vedio_long">22:22 </span>-->
          <!--</div>-->
          <!--<div class="l_msg_below">-->
            <!--<time>中国陶瓷官网 2017-6-23</time>-->
            <!--<span class="l_bottom_func mgnone"><img src="./images/shoucang@3x.png" alt=""></span>-->
            <!--<span class="l_bottom_func"><img src="./images/bianji@3x.png" alt=""> <i>33</i></span>-->
            <!--<span class="l_bottom_func"><img src="./images/zan@3x.png" alt=""> <i>55</i></span>-->
          <!--</div>-->
        <!--</a>-->
      <!--</li>-->
      <!--<li>-->
        <!--<a href="">-->
          <!--<div class="l_vedio_frame">-->
            <!--<h2 class="l_vedio_tit">河北省陶瓷</h2>-->
            <!--<em class="l_vedio_time">12万次播放</em>-->
            <!--<img src="./images/zzzz.png" alt="" class="l_vedio_bg" >-->
            <!--<img src="./images/bofang@3x.png" alt="" class="l_vedio_play">-->
            <!--<span class="l_vedio_long">22:22 </span>-->
          <!--</div>-->
          <!--<div class="l_msg_below">-->
            <!--<time>中国陶瓷官网 2017-6-23</time>-->
            <!--<span class="l_bottom_func mgnone"><img src="./images/shoucang@3x.png" alt=""></span>-->
            <!--<span class="l_bottom_func"><img src="./images/bianji@3x.png" alt=""> <i>33</i></span>-->
            <!--<span class="l_bottom_func"><img src="./images/zan@3x.png" alt=""> <i>55</i></span>-->
          <!--</div>-->
        <!--</a>-->
      <!--</li>-->
    </ul>
  </div>
</div>
<div class="j_foot-nav">
  <ul class="foot-navli">
    <li>
      <a href="./index.html"><img src="./images/shouye@3x.png"><br>首页</a>
    </li>
    <li class="now">
      <a href="video_list.html"><img src="./images/shipin2@3x.png"><br>视频</a>
    </li>
    <li id="release">
      <a href="javascript:;"><img src="./images/index_bar_release@3x.png"><br>发布</a>
    </li>
    <li>
      <a href="logistics-industry/logistics_circle.html"><img src="./images/huikan@3x.png"><br>会刊</a>
    </li>
    <li>
      <a href="mine/user-index.html"><img src="./images/wode@3x.png"><br>我的</a>
    </li>
  </ul>
</div>
<div class="l_dialog_mine">
  <ul class="l_release_select">
    <li data-id="0">
      <img src="./images/index_release_video@3x.png" alt="">
      <div>发布视频</div>
    </li>
    <li data-id="1">
      <img src="./images/index_release_article@3x.png" alt="">
      <div>发布文章</div>
    </li>
  </ul>
  <img class="l_close" src="./images/shanchu@3x.png" alt="">
</div>
<div class="l_mask"></div>
<div class="l_nothing_tip">
  <img src="./images/zanwuneirong@3x.png" alt="">
  <i class="l_marked_words"></i>
</div>
<script type="text/javascript">
  var $release = $('#release');
  var $mask = $('.l_mask');
  var $close = $('.l_close');
  var $dialogMask = $('.l_mask, .l_dialog_mine');
  var loginData = get('loginData');
  var $listPub = $('.l_list_pub');
  var $nothing = $('.l_nothing_tip');
  var $markedWords = $('.l_marked_words');
  var pageIndex = 1;
  var end;
  
  // init mui
  mui.init({
    pullRefresh: {
      container: '#pullrefresh',
      down: {
        callback: pulldownRefresh
      },
      up: {
        contentrefresh: '正在加载...',
        callback: pullupRefresh
      }
    }
  });
  
  // For the first time to load
  ajaxVideo(1);
  
  // method
  function pulldownRefresh() {
    mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
  }
  function pullupRefresh() {
    console.log(end)
    if (end === true) {
      this.endPullupToRefresh(true);
      
    } else {
      
      pageIndex ++;
      ajaxVideo(pageIndex);
      mui('#pullrefresh').pullRefresh().endPullupToRefresh();
    }

  }
  
  // event
  $listPub.on('tap', 'li', function () {
    console.log(33)
    var id = $(this).attr('data-id');
    location.href = 'http://172.16.3.241:8086/APPWeb/VideoReview?mi_id=' + id + '&source=2';
  });
  function ajaxVideo (page) {

    $.ajax({
      url: AjaxUrl + 'VideoList',
      type: 'POST',
      dataType: 'json',
      data: {
        'i_ui_inentifier': loginData.data.i_ui_identifier,
        'CurrentPage': page,
        'PageSize': 10
      },
      success: function (data) {
        var userData = data.data;
        var length = userData.length;
        var html = '';
        
        for (var i = 0; i < length; i ++) {
          html += '<li data-id="'+ userData[i].i_mi_identifier +'">'
                +  '<a href="javascript:;">'
                +    '<div class="l_vedio_frame">'
                +       '<h2 class="l_vedio_tit">'+ userData[i].title +'</h2>'
                +       '<em class="l_vedio_time">' + userData[i].bofangNum + '次播放</em>'
                +       '<img src="' + WebUrl +  userData[i].images_array + '" alt="" class="l_vedio_bg" >'
                +       '<img src="./images/bofang@3x.png" alt="" class="l_vedio_play">'
                +      '<span class="l_vedio_long">'+ userData[i].nvc_file_length + '</span>'
                +    '</div>'
                +    '<div class="l_msg_below">'
                +      '<time>'+ userData[i].source + ' ' + userData[i].time + '</time>'
                +      '<span class="l_bottom_func mgnone"><img src="./images/shoucang@3x.png" alt=""></span>'
                +      '<span class="l_bottom_func"><img src="./images/bianji@3x.png" alt=""> <i>'+ userData[i].pinglunNum +'</i></span>'
                +      '<span class="l_bottom_func"><img src="./images/zan@3x.png" alt=""> <i>'+ userData[i].dianzanNum +'</i></span>'
                +    '</div>'
                +  '</a>'
                +'</li>'
        }
        
        // last page
        if (length === 0) {
          end = true;
        }
        
        if (page === 1) {
          // without data tip
          if (length === 0) {
            $nothing.show();
            $markedWords.text('暂无视频');
          }

          $listPub.empty().append(html);
          return false;
        }
        
        $listPub.append(html);

      }
    })
  }
  
  // release
  $release.on('click', function () {
    if (loginData.data.RzState === 0 && loginData.data.RzType === 0) {
      location.href = 'mine/verify_private.html';
      return false;
    }
    if (loginData.data.RzState === 0 && loginData.data.RzType === 1) {
      location.href = 'mine/verify_company.html';
      return false;
    }
    document.body.style.overflow = 'hidden';
    $dialogMask.show();
  });
  // layer
  $mask.on('click', function () {
    $dialogMask.hide();
    document.body.style.overflow = '';
  });
  // close dialog
  $close.on('click', function () {
    $dialogMask.hide();
    document.body.style.overflow = '';
  });
  $('.l_release_select').on('click', 'li', function () {
    var id = $(this).attr('data-id');
    if (id === '0') {
      location.href = './release/video.html';
      return false;
    }
    location.href = './release/article.html';
  })

</script>
</body>
</html>
