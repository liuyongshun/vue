<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no" />
  <title>我的</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/mui.css">
  <script src="../js/commen.js"></script>
  <script src="../js/jquery-1.9.1.js"></script>
  <script src="../js/mui.min.js"></script>
  <script src="../js/rem.js"></script>
</head>
<body style="background-color: #fff">
<div class="l_nav_flex">
  <div class="l_flex_item hover" data-val="0"><span>关注</span></div>
  <div class="l_flex_item" data-val="1"><span>粉丝</span></div>
  <div class="l_flex_item" data-val="2"><span>访客</span></div>
</div>
<div id="pullrefresh" class="mui-content mui-scroll-wrapper" style="margin-top: 0.74rem;background-color: #fff;">
  <div class="mui-scroll">
    <ul class="l_wrap_box mui-table-view mui-table-view-striped mui-table-view-condensed">
      <!--<li>-->
      <!--<img class="l_user_avator" src="../images/identification_personage@3x.png" alt="">-->
      <!--<span class="l_user_name">15612879909</span>-->
      <!--<div class="l_attention_together">-->
      <!--<img src="../images/huxiang@3x.png" alt="">-->
      <!--互相关注-->
      <!--</div>-->
      <!--</li>-->
      <!--<li>-->
      <!--<img class="l_user_avator" src="../images/identification_personage@3x.png" alt="">-->
      <!--<span class="l_user_name">15612879909</span>-->
      <!--<div class="l_attention_together">-->
      <!--<img src="../images/huxiang@3x.png" alt="">-->
      <!--互相关注-->
      <!--</div>-->
      <!--</li>-->
    </ul>
  </div>
</div>
<div class="l_nothing_tip">
  <img src="../images/zanwuneirong@3x.png" alt="">
  <i class="l_marked_words"></i>
</div>
<script>
  // variable
  var loginData = get('loginData');
  var status = getParam('status');
  var $flex = $('.l_flex_item');
  var $nothing = $('.l_nothing_tip');
  var $wrapBox = $('.l_wrap_box');
  var $markedWords = $('.l_marked_words');
  var pageIndex = 1;
  var total;
  
  // init mui
  mui.init({
    pullRefresh: {
      container: '#pullrefresh',
      down: {
        callback: pulldownRefresh
      },
      up: {
        contentrefresh: '正在加载...',
        callback: pullupRefresh
      }
    }
  });
  
  // For the first time to load
  ajaxMethod(1, apiParam(status));
  
  // method
  function pulldownRefresh() {
    mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
  }
  function pullupRefresh() {
    pageIndex ++;
    if (pageIndex > total) {
      this.endPullupToRefresh(true);
      
    } else {
      ajaxMethod(pageIndex, apiParam(status));
      mui('#pullrefresh').pullRefresh().endPullupToRefresh();
      
    }
  }
  
  // check table about attention or fans or visitor
  function apiParam (arg) {
    var arr = ['GetUserAttention', 'GetPersonalFans', 'GetUserVisitors'];
    return arr[arg];
  }
  
  function tip (arg) {
    var arr = ['暂无关注', '暂无粉丝', '暂无访客'];
    return arr[arg];
  }
  
  function select (arg) {
  
  }
  
  // init status
  $flex.removeClass('hover');
  $flex.eq(status).addClass('hover');
  
  // toggle switch
  $flex.on('click', function () {
    // overwriting the value of status
    status = $(this).attr('data-val');
    
    $('.l_flex_item').removeClass('hover');
    $(this).addClass('hover');
    
    ajaxMethod(1, apiParam(status));
  });
  
  // get data ajax
  function ajaxMethod (page, api) {
    $.ajax({
      url:AjaxUrl + api,
      type:'POST',
      dataType:'json',
      data:{
        'i_ui_identifier': loginData.data.i_ui_identifier,
        'page': page
      },
      success: function(data) {
        
        var userData = data.data;
        var length = userData.length;
        var html = '';
        // pullup load page
        total = Math.ceil(data.tatalCount / length);
        
        if (length === 0) {
          $nothing.show();
          $markedWords.text(tip(status));
          
        } else {
          $nothing.hide();
          if (status === '2') {
            
            for (var i = 0; i < length; i ++) {
              html += '<li><img class="l_user_avator" src="'
                + userData[i].UserTouXiang
                + '" alt=""><span class="l_user_name">'
                + userData[i].UserName
                + '</span> <time class="fr" style="margin-top: 0.4rem">'
                + userData[i].Time
                + '</time></li>'
            }
            
          } else if (status === '0') {
            for (var j = 0; j < length; j ++) {
              
              html += '<li><img class="l_user_avator" src="'
                + userData[j].UserTouXiang
                + '" alt=""><span class="l_user_name">'
                + userData[j].UserName
                + '</span> <div class="l_attention_together">'
                + (userData[j].BlMutuallyClose === true ? ' <img src="../images/huxiang@3x.png" alt="">' : '<img src="../images/right.png" alt="">')
                + (userData[j].BlMutuallyClose === true ? '互相关注' : '已关注')
                + '</div> </li>'
            }
            
          } else {
            for (var k = 0; k < length; k ++) {
    
              html += '<li><img class="l_user_avator" src="'
                + userData[k].UserTouXiang
                + '" alt=""><span class="l_user_name">'
                + userData[k].UserName
                + '</span> <div class="l_attention_together'
                + (userData[k].BlMutuallyClose === true ? '' : ' l_red')
                + '">'
                + (userData[k].BlMutuallyClose === true ? '<img src="../images/right.png" alt="">' : '')
                + (userData[k].BlMutuallyClose === true ? '已关注' : '关注')
                + '</div> </li>'
            }
          }
          
          if (page === 1) {
            $wrapBox.empty().append(html);
            return false;
          }
          
          $wrapBox.append(html);
        }
      }
    })
  }
</script>
</body>
</html>
